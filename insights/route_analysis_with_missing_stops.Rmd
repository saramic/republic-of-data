---
title: "Route analysis with missing stops"
output: html_notebook
---

## Route 521

Route 521 which has stop [7891 Don Rd](https://www.ptv.vic.gov.au/stop/view/7891/) has stops that are missing
```
24318 24447 11092 24380 24440 44542 44593 24001 24277 24303 24254 24281 24267
```

## libraries and authentication

assuming pakages are installed
```
install.packages("bigrquery")
install.packages("ggplot2")
install.packages("readr")
install.packages("dplyr")
```

```{r}
library(bigrquery)
library(ggplot2)
library(dplyr)

project <- "republic-of-data-2018"
```

## Events by branch

```{r}
sql <-
"
SELECT
  RouteID
  , StopID
  , StopNameShort
  , GPSLat
  , GPSLong
  , CONCAT(GPSLat, ',', GPSLong) as long_lat
FROM clean.scans
LEFT JOIN data.stop_locations ON StopID = StopLocationID
WHERE RouteID = 521
GROUP BY RouteID, StopID, StopNameShort, GPSLat, GPSLong, long_lat
"

df_stops <- data.frame(query_exec(sql, project = project), useLegacySql = FALSE)
df_stops
```

```{r}
df_stops
df_stops_no_locations <- df_stops %>% filter_all(any_vars(is.na(.)))

as.list(df_stops_no_locations %>% select(StopID))
```
